<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Blocker Testing Suite - Professional Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #1f2937;
            --darker-bg: #111827;
            --text-light: #f9fafb;
            --text-muted: #9ca3af;
            --border-color: #374151;
            --glass-bg: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 100%);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rule-group {
            margin-bottom: 25px;
        }

        .rule-group h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--text-light);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }

        .rule-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .rule-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-color);
            transform: translateX(5px);
        }

        .rule-info {
            flex: 1;
        }

        .rule-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .rule-description {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .main-content {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: var(--text-light);
            background: var(--primary-color);
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            padding: 30px;
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Fake Website Styles */
        .fake-site {
            background: white;
            color: #333;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .site-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-nav {
            display: flex;
            gap: 20px;
        }

        .site-nav a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
        }

        .site-content {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .main-article {
            background: #fff;
        }

        .article-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #212529;
        }

        .article-content {
            line-height: 1.6;
            color: #495057;
            margin-bottom: 20px;
        }

        /* Ad Elements */
        .ad-banner {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            text-align: center;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .ad-sidebar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .popup-ad {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            text-align: center;
        }

        .floating-ad {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 999;
        }

        .video-ad {
            background: #000;
            color: white;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border-radius: 8px;
        }

        .native-ad {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid var(--warning-color);
        }

        .social-ad {
            background: #1877f2;
            color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }

        /* Hidden state */
        .ad-hidden {
            display: none !important;
            opacity: 0;
            transform: scale(0);
        }

        .ad-blocked {
            background: var(--danger-color) !important;
            color: white !important;
            position: relative;
        }

        .ad-blocked::after {
            content: "🚫 BLOCKED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Statistics Panel */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--glass-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Performance Chart */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .performance-bar {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-name {
            width: 150px;
            color: #333;
            font-weight: 500;
        }

        .bar {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 15px;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--primary-color));
            transition: width 0.5s ease;
        }

        .metric-value {
            color: #333;
            font-weight: bold;
            min-width: 60px;
        }

        /* Rule Editor */
        .rule-editor {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            margin-bottom: 20px;
        }

        .rule-editor textarea {
            width: 100%;
            background: transparent;
            border: none;
            color: inherit;
            font-family: inherit;
            resize: vertical;
            min-height: 200px;
            outline: none;
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-success {
            background: var(--success-color);
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-muted);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
            
            .site-content {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Animation for blocked ads */
        @keyframes blockAd {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.95); }
            100% { opacity: 0.3; transform: scale(0.9); }
        }

        .ad-blocking {
            animation: blockAd 0.5s ease-out forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛡️ Ad Blocker Testing Suite</h1>
            <p>Professional-grade testing environment for ad blocking rules and patterns</p>
        </div>

        <div class="control-panel">
            <div class="sidebar">
                <div class="section-title">
                    ⚙️ Filter Rules
                </div>
                
                <div class="rule-group">
                    <h3>Basic Ad Blocking</h3>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Banner Ads</div>
                            <div class="rule-description">Block display banners</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-banners" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Sidebar Ads</div>
                            <div class="rule-description">Block sidebar advertisements</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-sidebar" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Popup Ads</div>
                            <div class="rule-description">Block popup overlays</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-popups" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="rule-group">
                    <h3>Advanced Blocking</h3>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Video Ads</div>
                            <div class="rule-description">Block video advertisements</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-video">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Native Ads</div>
                            <div class="rule-description">Block native content ads</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-native">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Social Ads</div>
                            <div class="rule-description">Block social media ads</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-social">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="rule-item">
                        <div class="rule-info">
                            <div class="rule-name">Floating Ads</div>
                            <div class="rule-description">Block floating/sticky ads</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="block-floating">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="rule-group">
                    <h3>Test Controls</h3>
                    <button class="btn" onclick="testAllRules()">🧪 Test All Rules</button>
                    <button class="btn btn-success" onclick="enableAllRules()">✅ Enable All</button>
                    <button class="btn btn-danger" onclick="disableAllRules()">❌ Disable All</button>
                    <button class="btn" onclick="resetTest()">🔄 Reset</button>
                </div>
            </div>

            <div class="main-content">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('test-site')">🌐 Test Site</button>
                    <button class="tab" onclick="switchTab('statistics')">📊 Statistics</button>
                    <button class="tab" onclick="switchTab('performance')">⚡ Performance</button>
                    <button class="tab" onclick="switchTab('rules-editor')">🛠️ Rules Editor</button>
                </div>

                <div class="tab-content">
                    <div id="test-site" class="tab-pane active">
                        <div class="fake-site">
                            <div class="site-header">
                                <div>
                                    <h2>TechNews Daily</h2>
                                </div>
                                <nav class="site-nav">
                                    <a href="#">Home</a>
                                    <a href="#">Tech</a>
                                    <a href="#">Reviews</a>
                                    <a href="#">About</a>
                                </nav>
                            </div>

                            <div class="ad-banner" data-ad-type="banner">
                                🎯 SUPER SALE! 50% OFF EVERYTHING - CLICK NOW!
                            </div>

                            <div class="site-content">
                                <main class="main-article">
                                    <h1 class="article-title">Latest Technology Trends in 2025</h1>
                                    <div class="article-content">
                                        <p>The technology landscape continues to evolve rapidly, with artificial intelligence and machine learning leading the charge in innovation. Companies are investing heavily in these technologies to improve user experiences and automate complex processes.</p>
                                        
                                        <div class="video-ad" data-ad-type="video">
                                            📹 VIDEO AD: "Learn AI in 30 Days - Special Offer!"
                                            <br><small>Advertisement • 0:30 remaining</small>
                                        </div>

                                        <p>Cloud computing has become the backbone of modern businesses, enabling scalability and flexibility that was previously impossible. The shift to remote work has accelerated this adoption significantly.</p>

                                        <div class="native-ad" data-ad-type="native">
                                            📰 <strong>Sponsored Content:</strong> "10 Cloud Solutions That Will Transform Your Business"
                                            <br><small style="color: #666;">By CloudTech Solutions</small>
                                        </div>

                                        <p>Cybersecurity remains a top priority as digital threats become more sophisticated. Organizations must implement comprehensive security strategies to protect their valuable data and systems.</p>
                                    </div>
                                </main>

                                <aside class="sidebar-ads">
                                    <div class="ad-sidebar" data-ad-type="sidebar">
                                        💰 Investment Opportunity!<br>
                                        <small>Crypto Trading Made Easy</small>
                                    </div>
                                    
                                    <div class="social-ad" data-ad-type="social">
                                        👍 Promoted Post<br>
                                        <small>Like our page for tech updates!</small>
                                    </div>
                                    
                                    <div class="ad-sidebar" data-ad-type="sidebar">
                                        🎮 New Game Alert!<br>
                                        <small>Play now and get bonus coins</small>
                                    </div>
                                </aside>
                            </div>
                        </div>

                        <div class="popup-ad" id="popup-ad" data-ad-type="popup" style="display: none;">
                            <h3>🎉 Congratulations!</h3>
                            <p>You've won a $1000 gift card!</p>
                            <button class="btn" onclick="closePopup()">Claim Now</button>
                            <button class="btn btn-danger" onclick="closePopup()" style="margin-left: 10px;">✕ Close</button>
                        </div>

                        <div class="floating-ad" id="floating-ad" data-ad-type="floating">
                            📢 Limited Time Offer!<br>
                            <small>Subscribe for 70% off</small>
                        </div>
                    </div>

                    <div id="statistics" class="tab-pane">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="ads-blocked">0</div>
                                <div class="stat-label">Ads Blocked</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="ads-allowed">0</div>
                                <div class="stat-label">Ads Allowed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="block-rate">0%</div>
                                <div class="stat-label">Block Rate</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="rules-active">0</div>
                                <div class="stat-label">Active Rules</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 20px;">📈 Blocking Effectiveness by Ad Type</h3>
                            <div id="blocking-chart"></div>
                        </div>
                    </div>

                    <div id="performance" class="tab-pane">
                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 20px;">⚡ Performance Metrics</h3>
                            <div class="performance-bar">
                                <div class="metric-name">Page Load Time</div>
                                <div class="bar">
                                    <div class="bar-fill" id="load-time-bar" style="width: 75%;"></div>
                                </div>
                                <div class="metric-value" id="load-time-value">1.2s</div>
                            </div>
                            <div class="performance-bar">
                                <div class="metric-name">Memory Usage</div>
                                <div class="bar">
                                    <div class="bar-fill" id="memory-bar" style="width: 45%;"></div>
                                </div>
                                <div class="metric-value" id="memory-value">45MB</div>
                            </div>
                            <div class="performance-bar">
                                <div class="metric-name">CPU Usage</div>
                                <div class="bar">
                                    <div class="bar-fill" id="cpu-bar" style="width: 30%;"></div>
                                </div>
                                <div class="metric-value" id="cpu-value">30%</div>
                            </div>
                            <div class="performance-bar">
                                <div class="metric-name">Network Requests</div>
                                <div class="bar">
                                    <div class="bar-fill" id="network-bar" style="width: 60%;"></div>
                                </div>
                                <div class="metric-value" id="network-value">42</div>
                            </div>
                        </div>

                        <div class="chart-container" style="margin-top: 20px;">
                            <h3 style="color: #333; margin-bottom: 20px;">🎯 Improvement Analysis</h3>
                            <p style="color: #666; line-height: 1.6;">
                                Based on current blocking rules, the page performance has improved significantly:
                            </p>
                            <ul style="color: #666; margin: 15px 0; padding-left: 20px;">
                                <li><strong>25% faster load times</strong> due to blocked ad scripts</li>
                                <li><strong>40% less memory usage</strong> from blocked media content</li>
                                <li><strong>55% fewer network requests</strong> reducing bandwidth consumption</li>
                                <li><strong>Enhanced privacy</strong> by blocking tracking scripts</li>
                            </ul>
                        </div>
                    </div>

                    <div id="rules-editor" class="tab-pane">
                        <h3 style="margin-bottom: 20px;">🛠️ Custom Filter Rules Editor</h3>
                        <p style="color: var(--text-muted); margin-bottom: 20px;">
                            Create and test custom ad blocking rules using CSS selectors and URL patterns.
                        </p>
                        
                        <div class="rule-editor">
                            <textarea id="custom-rules" placeholder="Enter custom blocking rules here...

Example CSS Selectors:
.advertisement
[data-ad-type]
#popup-ad
.sponsored-content

Example URL Patterns:
*://ads.example.com/*
*://analytics.google.com/*
*://facebook.com/tr/*">
.advertisement { display: none !important; }
[data-ad-type="banner"] { opacity: 0.3 !important; }
#popup-ad { visibility: hidden !important; }
.sponsored-content { background: red !important; }</textarea>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <button class="btn" onclick="applyCustomRules()">🎯 Apply Rules</button>
                            <button class="btn" onclick="validateRules()">✅ Validate Syntax</button>
                            <button class="btn btn-danger" onclick="clearCustomRules()">🗑️ Clear Rules</button>
                            <button class="btn" onclick="exportRules()">📤 Export Rules</button>
                        </div>

                        <div id="rule-status" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>

                        <div class="chart-container">
                            <h3 style="color: #333; margin-bottom: 15px;">📋 Rule Testing History</h3>
                            <div id="rule-history" style="color: #666;">
                                No custom rules tested yet. Create and apply rules above to see results.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state management
        const state = {
            activeRules: new Set(),
            blockedAds: 0,
            allowedAds: 0,
            ruleHistory: [],
            performanceMetrics: {
                loadTime: 1.2,
                memory: 45,
                cpu: 30,
                networkRequests: 42
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            updateStatistics();
            simulatePopup();
            initializePerformanceMonitoring();
        });

        function initializeEventListeners() {
            // Rule toggle listeners
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.addEventListener('change', handleRuleToggle);
            });

            // Initialize with default rules enabled
            ['block-banners', 'block-sidebar', 'block-popups'].forEach(ruleId => {
                document.getElementById(ruleId).checked = true;
                state.activeRules.add(ruleId);
            });

            // Apply initial rules
            applyBlockingRules();
        }

        function handleRuleToggle(event) {
            const ruleId = event.target.id;
            const isEnabled = event.target.checked;

            if (isEnabled) {
                state.activeRules.add(ruleId);
                logRuleAction(ruleId, 'enabled');
            } else {
                state.activeRules.delete(ruleId);
                logRuleAction(ruleId, 'disabled');
            }

            applyBlockingRules();
            updateStatistics();
            updatePerformanceMetrics();
        }

        function applyBlockingRules() {
            const allAds = document.querySelectorAll('[data-ad-type]');
            
            allAds.forEach(ad => {
                const adType = ad.getAttribute('data-ad-type');
                const ruleId = `block-${adType === 'sidebar' ? 'sidebar' : adType}`;
                
                // Reset ad state
                ad.classList.remove('ad-hidden', 'ad-blocked', 'ad-blocking');
                ad.style.display = '';
                
                if (state.activeRules.has(ruleId)) {
                    // Add blocking animation
                    ad.classList.add('ad-blocking');
                    
                    setTimeout(() => {
                        ad.classList.add('ad-blocked');
                        if (ruleId === 'block-popups' || ruleId === 'block-floating') {
                            ad.style.display = 'none';
                            ad.classList.add('ad-hidden');
                        }
                    }, 500);
                }
            });

            // Update blocking chart
            updateBlockingChart();
        }

        function updateStatistics() {
            const allAds = document.querySelectorAll('[data-ad-type]');
            let blocked = 0;
            let allowed = 0;

            allAds.forEach(ad => {
                const adType = ad.getAttribute('data-ad-type');
                const ruleId = `block-${adType === 'sidebar' ? 'sidebar' : adType}`;
                
                if (state.activeRules.has(ruleId)) {
                    blocked++;
                } else {
                    allowed++;
                }
            });

            state.blockedAds = blocked;
            state.allowedAds = allowed;

            const blockRate = allAds.length > 0 ? Math.round((blocked / allAds.length) * 100) : 0;
            const activeRules = state.activeRules.size;

            document.getElementById('ads-blocked').textContent = blocked;
            document.getElementById('ads-allowed').textContent = allowed;
            document.getElementById('block-rate').textContent = blockRate + '%';
            document.getElementById('rules-active').textContent = activeRules;
        }

        function updateBlockingChart() {
            const adTypes = ['banner', 'sidebar', 'popup', 'video', 'native', 'social', 'floating'];
            const chartContainer = document.getElementById('blocking-chart');
            
            chartContainer.innerHTML = '';
            
            adTypes.forEach(type => {
                const ruleId = `block-${type}`;
                const isBlocked = state.activeRules.has(ruleId);
                const adsOfType = document.querySelectorAll(`[data-ad-type="${type}"]`).length;
                
                if (adsOfType > 0) {
                    const chartItem = document.createElement('div');
                    chartItem.className = 'performance-bar';
                    chartItem.innerHTML = `
                        <div class="metric-name" style="text-transform: capitalize;">${type} Ads</div>
                        <div class="bar">
                            <div class="bar-fill" style="width: ${isBlocked ? 100 : 0}%; background: ${isBlocked ? '#ef4444' : '#10b981'};"></div>
                        </div>
                        <div class="metric-value">${isBlocked ? 'Blocked' : 'Allowed'}</div>
                    `;
                    chartContainer.appendChild(chartItem);
                }
            });
        }

        function updatePerformanceMetrics() {
            const blockedCount = state.blockedAds;
            const totalAds = state.blockedAds + state.allowedAds;
            
            // Simulate performance improvements based on blocked ads
            const improvement = totalAds > 0 ? (blockedCount / totalAds) : 0;
            
            const baseMetrics = {
                loadTime: 2.1,
                memory: 75,
                cpu: 50,
                networkRequests: 68
            };
            
            state.performanceMetrics = {
                loadTime: Math.max(0.5, baseMetrics.loadTime - (baseMetrics.loadTime * 0.4 * improvement)),
                memory: Math.max(20, baseMetrics.memory - (baseMetrics.memory * 0.5 * improvement)),
                cpu: Math.max(10, baseMetrics.cpu - (baseMetrics.cpu * 0.4 * improvement)),
                networkRequests: Math.max(15, baseMetrics.networkRequests - (baseMetrics.networkRequests * 0.6 * improvement))
            };
            
            // Update performance bars
            const loadTimePercent = Math.min(100, (state.performanceMetrics.loadTime / 3) * 100);
            const memoryPercent = Math.min(100, (state.performanceMetrics.memory / 100) * 100);
            const cpuPercent = Math.min(100, (state.performanceMetrics.cpu / 100) * 100);
            const networkPercent = Math.min(100, (state.performanceMetrics.networkRequests / 100) * 100);
            
            document.getElementById('load-time-bar').style.width = loadTimePercent + '%';
            document.getElementById('memory-bar').style.width = memoryPercent + '%';
            document.getElementById('cpu-bar').style.width = cpuPercent + '%';
            document.getElementById('network-bar').style.width = networkPercent + '%';
            
            document.getElementById('load-time-value').textContent = state.performanceMetrics.loadTime.toFixed(1) + 's';
            document.getElementById('memory-value').textContent = Math.round(state.performanceMetrics.memory) + 'MB';
            document.getElementById('cpu-value').textContent = Math.round(state.performanceMetrics.cpu) + '%';
            document.getElementById('network-value').textContent = Math.round(state.performanceMetrics.networkRequests);
        }

        function initializePerformanceMonitoring() {
            // Simulate real-time performance monitoring
            setInterval(() => {
                // Add small random variations to make it feel realistic
                const variation = (Math.random() - 0.5) * 0.1;
                
                Object.keys(state.performanceMetrics).forEach(key => {
                    const currentValue = state.performanceMetrics[key];
                    const newValue = currentValue + (currentValue * variation);
                    state.performanceMetrics[key] = Math.max(0, newValue);
                });
                
                updatePerformanceMetrics();
            }, 3000);
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab pane
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update content based on tab
            if (tabName === 'statistics') {
                updateStatistics();
                updateBlockingChart();
            } else if (tabName === 'performance') {
                updatePerformanceMetrics();
            }
        }

        // Test control functions
        function testAllRules() {
            showLoadingState();
            
            setTimeout(() => {
                const results = [];
                
                document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                    const ruleId = toggle.id;
                    const wasEnabled = toggle.checked;
                    
                    // Test enabling the rule
                    toggle.checked = true;
                    toggle.dispatchEvent(new Event('change'));
                    
                    // Simulate test result
                    const testResult = {
                        rule: ruleId,
                        status: 'passed',
                        blockedElements: Math.floor(Math.random() * 5) + 1,
                        performance: Math.floor(Math.random() * 20) + 10
                    };
                    
                    results.push(testResult);
                    
                    // Restore original state
                    toggle.checked = wasEnabled;
                });
                
                displayTestResults(results);
                hideLoadingState();
            }, 2000);
        }

        function enableAllRules() {
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.checked = true;
                toggle.dispatchEvent(new Event('change'));
            });
            
            logRuleAction('all-rules', 'enabled');
        }

        function disableAllRules() {
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                toggle.checked = false;
                toggle.dispatchEvent(new Event('change'));
            });
            
            logRuleAction('all-rules', 'disabled');
        }

        function resetTest() {
            // Reset to default state
            state.activeRules.clear();
            state.blockedAds = 0;
            state.allowedAds = 0;
            
            document.querySelectorAll('.toggle-switch input').forEach(toggle => {
                const isDefault = ['block-banners', 'block-sidebar', 'block-popups'].includes(toggle.id);
                toggle.checked = isDefault;
                
                if (isDefault) {
                    state.activeRules.add(toggle.id);
                }
            });
            
            applyBlockingRules();
            updateStatistics();
            updatePerformanceMetrics();
            
            // Reset custom rules
            document.getElementById('custom-rules').value = `.advertisement { display: none !important; }
[data-ad-type="banner"] { opacity: 0.3 !important; }
#popup-ad { visibility: hidden !important; }
.sponsored-content { background: red !important; }`;
            
            logRuleAction('system', 'reset');
        }

        // Popup functionality
        function simulatePopup() {
            setTimeout(() => {
                const popup = document.getElementById('popup-ad');
                if (!state.activeRules.has('block-popups')) {
                    popup.style.display = 'block';
                    setTimeout(() => {
                        if (popup.style.display === 'block') {
                            closePopup();
                        }
                    }, 5000);
                }
            }, 3000);
        }

        function closePopup() {
            document.getElementById('popup-ad').style.display = 'none';
        }

        // Custom rules functionality
        function applyCustomRules() {
            const customRules = document.getElementById('custom-rules').value;
            const statusDiv = document.getElementById('rule-status');
            
            try {
                // Create and inject custom styles
                let customStyleSheet = document.getElementById('custom-styles');
                if (customStyleSheet) {
                    customStyleSheet.remove();
                }
                
                customStyleSheet = document.createElement('style');
                customStyleSheet.id = 'custom-styles';
                customStyleSheet.textContent = customRules;
                document.head.appendChild(customStyleSheet);
                
                statusDiv.innerHTML = '✅ Custom rules applied successfully!';
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'var(--success-color)';
                statusDiv.style.color = 'white';
                
                // Log the rule application
                logRuleAction('custom-rules', 'applied', customRules.split('\n').length + ' rules');
                
            } catch (error) {
                statusDiv.innerHTML = '❌ Error applying rules: ' + error.message;
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'var(--danger-color)';
                statusDiv.style.color = 'white';
            }
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        function validateRules() {
            const customRules = document.getElementById('custom-rules').value;
            const statusDiv = document.getElementById('rule-status');
            
            try {
                // Basic CSS validation
                const testElement = document.createElement('style');
                testElement.textContent = customRules;
                document.head.appendChild(testElement);
                document.head.removeChild(testElement);
                
                statusDiv.innerHTML = '✅ Rules syntax is valid!';
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'var(--success-color)';
                statusDiv.style.color = 'white';
                
            } catch (error) {
                statusDiv.innerHTML = '❌ Invalid CSS syntax: ' + error.message;
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'var(--danger-color)';
                statusDiv.style.color = 'white';
            }
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        function clearCustomRules() {
            document.getElementById('custom-rules').value = '';
            const customStyleSheet = document.getElementById('custom-styles');
            if (customStyleSheet) {
                customStyleSheet.remove();
            }
            
            logRuleAction('custom-rules', 'cleared');
        }

        function exportRules() {
            const activeRulesList = Array.from(state.activeRules);
            const customRules = document.getElementById('custom-rules').value;
            
            const exportData = {
                timestamp: new Date().toISOString(),
                activeRules: activeRulesList,
                customRules: customRules,
                statistics: {
                    blockedAds: state.blockedAds,
                    allowedAds: state.allowedAds,
                    blockRate: Math.round((state.blockedAds / (state.blockedAds + state.allowedAds)) * 100)
                },
                performance: state.performanceMetrics
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ad-blocker-rules-' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            logRuleAction('rules', 'exported');
        }

        // Utility functions
        function logRuleAction(ruleId, action, details = '') {
            const logEntry = {
                timestamp: new Date().toLocaleTimeString(),
                rule: ruleId,
                action: action,
                details: details
            };
            
            state.ruleHistory.unshift(logEntry);
            if (state.ruleHistory.length > 50) {
                state.ruleHistory.pop();
            }
            
            updateRuleHistory();
        }

        function updateRuleHistory() {
            const historyDiv = document.getElementById('rule-history');
            if (state.ruleHistory.length === 0) {
                historyDiv.innerHTML = 'No custom rules tested yet. Create and apply rules above to see results.';
                return;
            }
            
            const historyHTML = state.ruleHistory.slice(0, 10).map(entry => `
                <div style="padding: 8px; border-bottom: 1px solid #eee; font-family: monospace;">
                    <span style="color: #666;">${entry.timestamp}</span> - 
                    <span style="font-weight: bold;">${entry.rule}</span> 
                    <span style="color: var(--primary-color);">${entry.action}</span>
                    ${entry.details ? `<span style="color: #666;"> (${entry.details})</span>` : ''}
                </div>
            `).join('');
            
            historyDiv.innerHTML = historyHTML;
        }

        function showLoadingState() {
            const testButton = document.querySelector('button[onclick="testAllRules()"]');
            testButton.innerHTML = '<span class="loading-spinner"></span> Testing...';
            testButton.disabled = true;
        }

        function hideLoadingState() {
            const testButton = document.querySelector('button[onclick="testAllRules()"]');
            testButton.innerHTML = '🧪 Test All Rules';
            testButton.disabled = false;
        }

        function displayTestResults(results) {
            const resultsHTML = results.map(result => `
                <div style="background: var(--glass-bg); padding: 10px; margin: 5px 0; border-radius: 5px;">
                    <strong>${result.rule}</strong>: ${result.status} 
                    (${result.blockedElements} elements blocked, +${result.performance}% performance)
                </div>
            `).join('');
            
            const statusDiv = document.getElementById('rule-status');
            statusDiv.innerHTML = '<h4>🧪 Test Results:</h4>' + resultsHTML;
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'var(--success-color)';
            statusDiv.style.color = 'white';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 10000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case '1':
                        event.preventDefault();
                        switchTab('test-site');
                        break;
                    case '2':
                        event.preventDefault();
                        switchTab('statistics');
                        break;
                    case '3':
                        event.preventDefault();
                        switchTab('performance');
                        break;
                    case '4':
                        event.preventDefault();
                        switchTab('rules-editor');
                        break;
                    case 'r':
                        event.preventDefault();
                        resetTest();
                        break;
                    case 't':
                        event.preventDefault();
                        testAllRules();
                        break;
                }
            }
        });

        // Add some visual enhancements
        document.addEventListener('mousemove', function(event) {
            const header = document.querySelector('.header');
            const rect = header.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                const xPercent = (x / rect.width) * 100;
                const yPercent = (y / rect.height) * 100;
                
                header.style.background = `linear-gradient(${xPercent}deg, var(--primary-color), var(--secondary-color))`;
            }
        });
    </script>
</body>
</html>